

    
                    NEWZNAB Usenet Searching Web API 


                               v0.1
                             30/6/2010


Owner:  bb   at #newznab        (irc.synirc.org)
Author: ensi at #newznab        (irc.synirc.org)   ensisoft@gmail.com

1.  Introduction
2.  Functions
2.1 CAPS
2.2 SEARCH

TODO:
  - tv-rage ??
  - authorization
  - error codes
  - standard category names?


1. Introduction
   
   This document describes the NEWZNAB Usenet Searching Web API. The API is designed for NZB aware client
   applications to perform searches to a particular NEWZNAB implementation using HTTP queries and receive
   matching search results and NZB data for downloading the material in question.
   
   This document does not describe the actual implementation of either the client or the server but just
   describes the HTTP interface and request/response sequences.

   Intended readers are server and client implementers.

1.1 Notation
    
    This document uses the follocation notations:
    
    Parameters: "t=c" denotes a required HTTP query parameter. [o=json | o=xml] denotes optional 
    parameters with possible values.


2. Functions
   
   All functions are executed as HTTP requests over TCP. All parameters are to be passed
   as query parmeters unless otherwise indicated. All returned XML/JSON data is UTF-8 encoded
   unless otherwise specified. All query parameters should be UTF-8 and URL encoded, i.e.
   query-param = URL-ENCODE( UTF8-ENCODE(param=value))
   

   2.1 CAPS

   Description: 
     CAPS function is used to query the server for supported features and the protocol version and other 
     meta data relevant to the implementation. This function doesn't require the client to provide any
     login information but can be executed out of "login session".

     Important fields of the returned data:
      server/version - the version of the procol implemented by the server. All implementations         
                       should be backwards compatible. 
      caps/category  - Defines a searchable category which might have any number of subcategories.

   HTTP Method: 
     POST
      
   Parameters:  
     t=caps                    caps function
     [o=json | o=xml]          output format, either JSON or XML (default is XML)

   Responses:  
     200 OK
     404 Not Found

   Example:
     --> POST http://nzb.su/api?t=c
     <-- 200 OK
        <?xml version="1.0" encoding="UTF-8"?>
          <caps>
            <server version="1.0" title="Newznab" strapline="A great usenet indexer" email="info@newznab.com" url="http://nzb.su/" image="http://nzb.su/theme/black/images/banner.jpg"/>
            <search>
                <category id="100" name="Console">
                  <subcat id="101" name="NDS"/>
                  <subcat id="102"  name="PSP"/>
                </category>
                <category id="200" name="Movies">
                  <subcat id="201" name="DVD"/>
                </category>
                <category id="1000" name="extra-spice"/>
                ...
            </search>
          </caps>
        </xml>
        
    TBD:
     - more searching options: 
       conditional operations,
       attributes,
       wild cards,
       regex


   2.2 SEARCH
   
   Description:
      SEARCH function searches the index for items matching the search criteria. On succesful
      search the response contains a list of found items. Even if search matched nothing an empty
      response set is created and returned. This function requires passing the user credentials.
      
      Searches that include categories that are not supported by the server are still executed
      but the non-supported categories are simply skipped. This basically treats such a search
      simply as a "no match" but allows the same query to be ran simultaneously against several 
      servers. 
      
      The list of search categories specifies a logical OR condition. I.e. an item matching the 
      search input in any of the specified categories is considered a match and is returned. E.g.
      a search searching for "linux" in "computer" and "ebook" categories searches for matching
      items in "computer" and "ebook" but does not search for example the "movies" category.
      Items found in either group are then combined into a single result set.
      
      Important fields of the returned data:
        pubdate - the publishing date in RSS date object as specified by RFC822/2822
        size    - the size of the object in bytes
        nzb     - url for retrieving the NZB content via 

    HTTP Method:
      POST
      
    Parameters:
      t=search          search function
      q=xxxx            search input (UTF-8/URL encoded)
      key=xxxx          user's key as provided by the service implementer
      [o=json | o=xml]  output format, either JSON or XML (default is XML)

    Response:
      200 OK
      403 Forbidden
      404 Not found

    Error Codes:
      xxx - Incorrect password or username
      xxx - account suspended
      xxx - insufficient priviledges

    Example:
      --> POST http://nzb.su/api?t=search&key=xxxxx&q=linux%20image
      <-- 200 OK
          <?xml version="1.0" encoding="UTF-8"?>
          <search>
                <match 
                  name="Perforce.v2009.2.Linux.Incl.Keyfilemaker-EMBRACE
                  category="123"
                  pubdate="Fri, 26 Feb 2010 13:47:54 +0000"
                  size="112197632"
                  nzb="http://nzb.su/nzbs/index.php?nzbid=21212"
                </match>
                <match 
                  name="debian linux 3.2 iso"
                  category="123"
                  pubdate="Fri, 26 Feb 2010 13:47:54 +0000"
                  size="112197632"
                  nzb="http://nzb.su/nzbs/index.php?nzbid=21212"
                </match>
                ....
          </search>
          </xml>
          
      // no items matched the search criteria
      --> POST http://nzb.su/api?t=search&key=xxxxx&q=linux%20image
      <-- 200 OK
          <?xml version="1.0" encoding="UTF-8"?>
             <search/>
          </xml>

     // query could not be completed because of broken credentials
     --> POST http://nzb.su/api?t=search&key=xxxxx&q=linux%20image
     <-- 403  Forbidden
         <?xml version="1.0" encoding="UTF-8"?>
           <error code="xxx" description="Incorrect password or username"/>
         </xml>

     // query could not be completed because it was malformed
     --> POST http://nzb.su/api?t=search&key=xxxxx&q=linux%20image
     <-- 404 Not Found
         <?xml version="1.0" encoding="UTF-8"/>
           <error code="xxx" description="Missing parameter: key"/>
         </xml>

         
            
   
   
